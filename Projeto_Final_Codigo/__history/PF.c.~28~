#include <PF.h>

int1 fimtempo = 0;
int16 tempo = 0;
int8 i = 0, j = 0, tabuleirox = 0, tabuleiroy = 0;
int8 pontuacaoJ1 = 0, pontuacaoJ2 = 0, ganhador = 0;
int8 tabuleiro[3][3];

#INT_TIMER0
void  TIMER0_isr(VOID) {

   tempo += 1;
   
   if(tempo == 50){
   
      tempo = 0;
      fimtempo = 1;
   
   }

}

void reinicia_tabuleiro(){

   for(i = 0; i < 3; i++){
   
      for(j = 0; j < 3; j++){
      
         tabuleiro[i][j] = -1;
      
      }
   
   }

}

void acende_tabuleiro(int8 x, y){

//! SE EU DER OUTPUT LOW EM TODOS OS PINOS ANTES DE VIR AQUI PRA ACENDER, EU SÓ VOU PRECISAR ACENDER OS ESPECIFICOS DE CADA IF

   if(x == 1){
      
      output_low(LIN1);
      output_high(LIN2);
      output_high(LIN3);
      
   }
   
   else if(x == 2){
   
      output_high(LIN1);
      output_low(LIN2);
      output_high(LIN3);
   
   }
   
   else{
   
      output_high(LIN1);
      output_high(LIN2);
      output_low(LIN3);
   
   }

   if(tabuleiro[x][y] == 1){
   
      output_low(GREEN1);
      output_low(GREEN2);
      output_low(GREEN3);
   
      if(y == 0){
      
         output_high(RED1);
         output_low(RED2);
         output_low(RED3);
      
      }
      
      else if(y == 1){
      
         output_low(RED1);
         output_high(RED2);
         output_low(RED3);
      
      }
      
      else{
      
         output_low(RED1);
         output_low(RED2);
         output_high(RED3);
      
      }
   
   }
   
   else if(tabuleiro[x][y] == 2){
   
      output_low(RED1);
      output_low(RED2);
      output_low(RED3);
   
      if(y == 0){
      
         output_high(GREEN1);
         output_low(GREEN2);
         output_low(GREEN3);
      
      }
      
      else if(y == 1){
      
         output_low(GREEN1);
         output_high(GREEN2);
         output_low(GREEN3);
      
      }
      
      else{
      
         output_low(GREEN1);
         output_low(GREEN2);
         output_high(GREEN3);
      
      }
   
   }
   
   else if(tabuleiro[x][y] == 0){
   
      output_low(RED1);
      output_low(RED2);
      output_low(RED3);
      output_low(GREEN1);
      output_low(GREEN2);
      output_low(GREEN3);
      
      if(y == 0){
      
         output_high(RED1);
         output_low(RED2);
         output_low(RED3);
         output_high(GREEN1);
         output_low(GREEN2);
         output_low(GREEN3);
      
      }
      
      else if(y == 1){
      
         output_low(RED1);
         output_high(RED2);
         output_low(RED3);
         output_low(GREEN1);
         output_high(GREEN2);
         output_low(GREEN3);
      
      }
      
      else{
         
         output_low(RED1);
         output_low(RED2);
         output_high(RED3);
         output_low(GREEN1);
         output_low(GREEN2);
         output_high(GREEN3);
      
      }
   
   }
   
   else{
   
      output_low(RED1);
      output_low(RED2);
      output_low(RED3);
      output_low(GREEN1);
      output_low(GREEN2);
      output_low(GREEN3);
   
   }

}

int8 verifica_ganhador(int8 matriz[3][3]){
    
    for(i = 0; i < 3; i++){
        
        if(matriz[i][0] != -1 && matriz[i][0] == matriz[i][1] && matriz[i][0] == matriz[i][2])
            return matriz[i][0];
        if(matriz[0][i] != -1 && matriz[0][i] == matriz[1][i] && matriz[0][i] == matriz[2][i])
            return matriz[0][i];
        
    }
    
    if(matriz[0][0] != -1 && matriz[0][0] == matriz[1][1] && matriz[0][0] == matriz[2][2])
        return matriz[0][0];
        
    else if(matriz[0][2] != -1 && matriz[0][2] == matriz[1][1] && matriz[0][2] == matriz[2][0])
        return matriz[0][2];
    
    else
        return 0;
    
}

void main(){
   setup_timer_0 (RTCC_INTERNAL|RTCC_DIV_8|RTCC_8_BIT); //1, 0 ms overflow
   enable_interrupts (INT_TIMER0) ;
   enable_interrupts (GLOBAL) ;
   
   reinicia_tabuleiro();
   
   tabuleiro[0][0] = 1;
   tabuleiro[0][1] = 2;
   tabuleiro[0][2] = 0;

   WHILE(TRUE){
   
      if(fimtempo){
      
         tabuleiroy += 1;
   
         if(tabuleiroy == 3){
         
            tabuleirox += 1;
            tabuleiroy = 0;
            
            if(tabuleirox == 3){
            
               tabuleirox = 0;
            
            }
         
         }
      
         acende_tabuleiro(tabuleirox, tabuleiroy);
         
         fimtempo = 0;
      
      }
   
   }
}
